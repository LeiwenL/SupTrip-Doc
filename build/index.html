<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>SupTrip CAMPUS</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["html","java"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="html">html</a>
              <a href="#" data-language-name="java">java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Documentation Powered by SupTrip Campus TEAM</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Bienvenue sur la documentation officielle de SupTrip Campus! 
Vous pouvez utiliser notre application pour avoir accès à de nombreux voyages entre tous les campus. N&#39;hésitez plus!</p>

<p>Nous avons plusieurs langages au sein de notre application (Java JEE, JQuery/JavaScript, HTML5, intégration du framework BootStrap). Vous pouvez voir des exemples de code dans la zone sombre à votre droite, vous pouvez changer la langue de programmation en fonction des exemples donnés avec les onglets en haut à droite.</p>

<h1 id="page-d-39-accueil">Page d&#39;accueil</h1>

<blockquote>
<p>Message de bienvenue, si l&#39;utilisateur est connecté il sera affiché avec son ID Booster &amp; restitution de statistiques diverses et variées.</p>
</blockquote>
<pre class="highlight html"><code><span class="c">&lt;!-- HOME.JSP --&gt;</span>
<span class="c">&lt;!-- WELCOME MESSAGE --&gt;</span>
    <span class="nt">&lt;c:choose&gt;</span>
        <span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">"${! empty sessionScope.user.getIdbooster()}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2&gt;</span>
                Bienvenue à toi,
                <span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">"${sessionScope.user.getIdbooster()}"</span> <span class="nt">/&gt;</span>
                !
            <span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;/c:when&gt;</span>
        <span class="nt">&lt;c:otherwise&gt;</span>
            <span class="nt">&lt;h2&gt;</span>Bienvenue !<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;/c:otherwise&gt;</span>
    <span class="nt">&lt;/c:choose&gt;</span>

    <span class="c">&lt;!-- CONTENT --&gt;</span>
    ...
    <span class="c">&lt;!-- END CONTENT --&gt;</span>

    <span class="c">&lt;!-- Début restitution des stats --&gt;</span>
    <span class="nt">&lt;p&gt;</span>
        C'est <span class="nt">&lt;b&gt;&lt;c:out</span> <span class="na">value=</span><span class="s">"${requestScope.countUser}"</span> <span class="nt">/&gt;&lt;/b&gt;</span>
        utilisateurs passionés par SupTrip !
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
        C'est <span class="nt">&lt;b&gt;&lt;c:out</span> <span class="na">value=</span><span class="s">"${requestScope.countCampus}"</span> <span class="nt">/&gt;&lt;/b&gt;</span> campus
        actifs par SupTrip !
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
        C'est <span class="nt">&lt;b&gt;&lt;c:out</span> <span class="na">value=</span><span class="s">"${requestScope.countTrip}"</span> <span class="nt">/&gt;&lt;/b&gt;</span> voyages
        organisés par SupTrip !
    <span class="nt">&lt;/p&gt;</span>

    <span class="c">&lt;!-- TOP USER --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-10 col-centered custyle"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-striped custab"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;thead&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;th&gt;</span>ID Booster<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Prénom<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Nom du campus<span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;th&gt;</span>Nb de voyages<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/thead&gt;</span>
            <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"user"</span> <span class="na">items=</span><span class="s">"${users}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${user.getIdbooster() != 0 }"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td&gt;</span>#1 ${user.getIdbooster()}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${user.getFirstname()}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>${user.getCamp().getName()}<span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;span</span> <span class="na">class=</span><span class="s">'btn btn-info btn-xs'</span><span class="nt">&gt;</span>${user.trips.size()} voyages<span class="nt">&lt;/span&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/c:if&gt;</span>
            <span class="nt">&lt;/c:forEach&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>          
</code></pre>
<pre class="highlight java"><code><span class="n">String</span> <span class="n">countUser</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getUserDao</span><span class="o">().</span><span class="na">countUser</span><span class="o">();</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Camp</span><span class="o">&gt;</span> <span class="n">listOfCampus</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getCampDao</span><span class="o">().</span><span class="na">getAllCampus</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">countCampus</span> <span class="o">=</span> <span class="n">listOfCampus</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">countTrip</span> <span class="o">=</span> <span class="o">(</span><span class="n">countCampus</span> <span class="o">*</span> <span class="o">(</span><span class="n">countCampus</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>


<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;)</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getUserDao</span><span class="o">().</span><span class="na">getAllUsers</span><span class="o">();</span>

<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"users"</span><span class="o">,</span> <span class="n">users</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"countTrip"</span><span class="o">,</span> <span class="n">countTrip</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"countCampus"</span><span class="o">,</span> <span class="n">countCampus</span><span class="o">);</span>
<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"countUser"</span><span class="o">,</span> <span class="n">countUser</span><span class="o">);</span>

<span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/home.jsp"</span><span class="o">);</span>
<span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</code></pre>

<p><b>Un résumé :</b> SupTrip est une toute nouvelle agence de voyage innovante créé par SUPINFO. Si vous aimez voyager facilement, vous êtes au bon endroit ! N’hésitez pas à vous inscrire et bénéficiez de nombreux tarifs étudiants !</p>

<h3 id="integration-des-tagslibs">Integration des tagsLibs:</h3>

<p>Les librairies de tags JSP (Taglibs) nous a permis de gérer quelques actions plus facilement. L&#39;intégration se fait en une seule ligne: 
<code>&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;</code></p>

<aside class="notice">
Une fois connecté sur notre site, vous aurez accès à l'onglet &ldquo;Panier&rdquo; et &ldquo;Voyager&rdquo;.
</aside>

<h1 id="utilisateur-inscription">Utilisateur - Inscription</h1>

<blockquote>
<p>Formulaire d&#39;inscription utilisateur, doPost().</p>
</blockquote>
<pre class="highlight html"><code><span class="c">&lt;!-- EGISTER.JSP - Exemple : champ "nom de famille" et champ "nom du campus" - Utilisation de pattern (regExp) --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"lastname"</span> <span class="na">name=</span><span class="s">"lastname"</span> <span class="na">maxlength=</span><span class="s">"50"</span>
        <span class="na">placeholder=</span><span class="s">"Nom de famille"</span> <span class="na">required</span> <span class="na">pattern=</span><span class="s">"\S+"</span>
        <span class="na">tabindex=</span><span class="s">"3"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-12 col-sm-6 col-md-6"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"campusId"</span> <span class="na">class=</span><span class="s">"form-control"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"camp"</span> <span class="na">items=</span><span class="s">"${listOfCampus}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"${camp.getId()}"</span><span class="nt">&gt;</span>${camp.getName()}<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/c:forEach&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-info btn-block md"</span><span class="nt">&gt;</span>Envoyer<span class="nt">&lt;/button&gt;</span>

</code></pre>
<pre class="highlight java"><code><span class="c1">//RegisterServlet.java - Extrait de la méthode doPost(); </span>

    <span class="n">userExists</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getUserDao</span><span class="o">().</span><span class="na">UserExists</span><span class="o">(</span><span class="n">tmp_idbooster</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">userExists</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"registerfailed"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/register.jsp"</span><span class="o">);</span>
        <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
        <span class="n">Camp</span> <span class="n">camp</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getCampDao</span><span class="o">().</span><span class="na">getCamp</span><span class="o">(</span><span class="n">campusId</span><span class="o">);</span>
        <span class="c1">// etc ...</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setCamp</span><span class="o">(</span><span class="n">camp</span><span class="o">);</span>
        <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getUserDao</span><span class="o">().</span><span class="na">addUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

        <span class="n">HttpSession</span> <span class="n">httpSession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        <span class="n">httpSession</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/home"</span><span class="o">);</span>
</code></pre>

<p>SupTrip Campus utilise un formulaire d&#39;inscription pour pouvoir garder nos utilisateurs en base et ainsi gérer leurs demandes au niveau des voyages.</p>

<h3 id="parametres">Parametres</h3>

<table><thead>
<tr>
<th>Paramètre</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>IdBooster</td>
<td>Int</td>
<td><b>Obligatoire &amp; Unique.</b> Entre 5 et 8 chiffres maximum.</td>
</tr>
<tr>
<td>FirstName</td>
<td>String</td>
<td><b>Obligatoire.</b> Limité à 50 charactères maximum, n&#39;accepte pas les espaces blancs (trim).</td>
</tr>
<tr>
<td>LastName</td>
<td>String</td>
<td><b>Obligatoire.</b> Limité à 50 charactères maximum, n&#39;accepte pas les espaces blancs (trim).</td>
</tr>
<tr>
<td>CampusName</td>
<td>String</td>
<td>Non obligatoire. Limité à une liste de campus.</td>
</tr>
<tr>
<td>Email</td>
<td>String</td>
<td>Non obligatoire. Doit suivre le pattern <code>pattern=&quot;[a-zA-Z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$&quot;</code>.</td>
</tr>
<tr>
<td>Password</td>
<td>String</td>
<td><b>Obligatoire.</b> Avec double vérification (JQuery), limité à 50 charactères maximum, n&#39;accepte pas les espaces blancs (trim). Stocké en MD5 !</td>
</tr>
</tbody></table>

<aside class="notice"> 
<b>Côté FRONT</b> : <br/>
- Intégration du framework BootStrap. <br/>
- Utilisation du côté HTML des taglibs en Java JEE <code>"c:forEach"</code>. <br/ >
- Notre page page HTML est au format .JSP d'où : <code>items=${listOfCampus}</code>. <br/>
- Vérification du mot de passe identique avec JQuery. <br/> <br/>
<b>Côté BACK</b> : <br/>
- Utilisation de notre DaoFactory qui inclue notre classe User. <br/>
- Vérification que l'on récupère correctement notre ID-BOOSTER.<br/ >
- Création de la session de l'utilisateur : <code>HttpSession httpSession = req.getSession();</code>.
</aside>

<h1 id="utilisateur-connexion">Utilisateur - Connexion</h1>

<blockquote>
<p>Formulaire de la connexion utilisateur, doPost(), vérification.</p>
</blockquote>
<pre class="highlight html"><code><span class="c">&lt;!-- LOGIN.JSP --&gt;</span>

<span class="c">&lt;!-- Check Login - Error Message --&gt;</span>
<span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${loginfailed}"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"bg-danger"</span> <span class="na">style=</span><span class="s">"padding: .5em;"</span><span class="nt">&gt;</span>Identifiant ou mot de passe incorrect.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-container small-panel"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- Form Begin --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-box"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"login"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">name=</span><span class="s">"idbooster"</span> <span class="na">min=</span><span class="s">"0"</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Votre ID-Booster"</span> 
            <span class="na">required</span> <span class="na">pattern=</span><span class="s">"[0-9]{5,8}"</span> <span class="na">title=</span><span class="s">"Votre ID doit contenir 5 à 8 chiffres."</span> <span class="na">style=</span><span class="s">"padding-left: 1.3em;"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"last-input"</span> <span class="na">maxlength=</span><span class="s">"50"</span> <span class="na">placeholder=</span><span class="s">"Entrez votre mot de passe"</span> <span class="na">type=</span><span class="s">"password"</span>
            <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">required</span> <span class="na">pattern=</span><span class="s">"\S+"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-info btn-block md"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Connexion<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">//LoginServlet.java - extrait de la méthode doPost();</span>
<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
<span class="n">String</span> <span class="n">idbooster</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"idbooster"</span><span class="o">);</span>
<span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">Hash</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">),</span> <span class="s">"MD5"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchAlgorithmException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getUserDao</span><span class="o">().</span><span class="na">getUser</span><span class="o">(</span><span class="n">idbooster</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>

<span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">HttpSession</span> <span class="n">httpSession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
    <span class="n">httpSession</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
    <span class="n">resp</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">getServletContext</span><span class="o">().</span><span class="na">getContextPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/home"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"loginfailed"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/login.jsp"</span><span class="o">);</span>
    <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>

<p>SupTrip Campus utilise un formulaire de connexion pour pouvoir donner tous les accès à nos utilisateurs en base et ainsi accéder à des pages supplémentaires. Nous avons mis en place l&#39;utilisation d&#39;un filtre (authentication).</p>

<h3 id="parametres">Parametres</h3>

<table><thead>
<tr>
<th>Paramètre</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>IdBooster</td>
<td>Int</td>
<td><b>Obligatoire.</b> Entre 5 et 8 chiffres maximum.</td>
</tr>
<tr>
<td>Password</td>
<td>String</td>
<td><b>Obligatoire.</b> Vérification via la BDD, limité à 50 charactères maximum, n&#39;accepte pas les espaces blancs (trim).</td>
</tr>
</tbody></table>

<aside class="warning">
Si Combinaison ID-Booster/MDP non valide, affichage d'un message d'erreur. 
</aside>

<aside class="success">
Si Combinaison ID-Booster/MDP valide, création de la session pour l'utilisateur, redirection sur la page d'accueil. 
</aside>

<h1 id="trip-liste-des-voyages">Trip - Liste des voyages</h1>

<blockquote>
<p>Listing de tous les voyages possibles, addTrip();</p>
</blockquote>
<pre class="highlight html"><code><span class="c">&lt;!-- TRIP.JSP --&gt;</span>
<span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-striped custab"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th</span> <span class="na">class=</span><span class="s">"th-cart"</span><span class="nt">&gt;</span>Départ<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th</span> <span class="na">class=</span><span class="s">"th-cart"</span><span class="nt">&gt;</span>Arrivée<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="err">&lt;</span>% int count = 1; %&gt;
    <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">"${campusOrder}"</span> <span class="na">var=</span><span class="s">"departure"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">"${listOfCampus}"</span> <span class="na">var=</span><span class="s">"arrival"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">class=</span><span class="s">"row-trip"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">"${departure.getId() != arrival.getId()}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%=count%&gt; <span class="err">&lt;</span>% count++;%&gt;.
                         <span class="ni">&amp;nbsp;</span><span class="nt">&lt;c:out</span> <span class="na">value=</span><span class="s">"${departure.getName()}"</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;&lt;c:out</span> <span class="na">value=</span><span class="s">"${arrival.getName()}"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
                    <span class="nt">&lt;td&gt;</span>
                        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"addTrip"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"departure"</span> <span class="na">value=</span><span class="s">"&lt;c:out value="</span><span class="err">${</span><span class="na">departure</span><span class="err">.</span><span class="na">getId</span><span class="err">()}"</span> <span class="nt">/&gt;</span>"&gt;
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"arrival"</span> <span class="na">value=</span><span class="s">"&lt;c:out value="</span><span class="err">${</span><span class="na">arrival</span><span class="err">.</span><span class="na">getId</span><span class="err">()}"</span> <span class="nt">/&gt;</span>"&gt;
                            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-info"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-shopping-cart"</span><span class="nt">&gt;&lt;/span&gt;</span> Ajouter au panier
                            <span class="nt">&lt;/button&gt;</span>
                        <span class="nt">&lt;/form&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/c:if&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/c:forEach&gt;</span>
    <span class="nt">&lt;/c:forEach&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">//AddTripServlet.java - Extrait de la méthode doPost();</span>
    <span class="n">Camp</span> <span class="n">departure</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getCampDao</span><span class="o">().</span><span class="na">getCamp</span><span class="o">(</span><span class="n">idDeparture</span><span class="o">);</span>
    <span class="n">Camp</span> <span class="n">arrival</span> <span class="o">=</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getCampDao</span><span class="o">().</span><span class="na">getCamp</span><span class="o">(</span><span class="n">idArrival</span><span class="o">);</span>

    <span class="n">Trip</span> <span class="n">trip</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Trip</span><span class="o">();</span>

    <span class="n">trip</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="n">trip</span><span class="o">.</span><span class="na">setDeparture</span><span class="o">(</span><span class="n">departure</span><span class="o">);</span>
    <span class="n">trip</span><span class="o">.</span><span class="na">setArrival</span><span class="o">(</span><span class="n">arrival</span><span class="o">);</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">list</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;();</span>
    <span class="o">}</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">trip</span><span class="o">);</span>
    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
    <span class="n">resp</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/auth/shoppingCart"</span><span class="o">);</span>
    <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>  
</code></pre>

<p>SupTrip Campus utilise deux méthodes d&#39;affichage pour lister tous les voyages possibles. La première sous forme de deux select, la seconde consiste à afficher tous les voyages sous forme de tableau. Pour faciliter la tâche à notre utilisateur, nous lui avons mis à disposition une pagination par ordre alphabétique et une barre de recherche.</p>

<aside class="warning">
Il est impossible à l'utilisateur de choisir un campus de départ égal au campus d'arrivée. Gestion côté front et back (JQuery & Java) 
</aside>

<aside class="success">
Une fois un voyage ajoutée au panier, l'utilisateur va être redirigé vers la page &ldquo;Panier&rdquo; avec une liste de ses voyages.
</aside>

<h1 id="trip-panier">Trip - Panier</h1>

<blockquote>
<p>Ajout sur le compte utilisateur des différents trips présent dans le panier - confirmation de l&#39;ajout.</p>
</blockquote>
<pre class="highlight html"><code><span class="c">&lt;!-- ShoppingCart.JSP --&gt;</span>
<span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-hover"</span><span class="nt">&gt;</span>
<span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"trip"</span> <span class="na">items=</span><span class="s">"${sessionScope.listOfTrips}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"col-sm-8 col-md-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"media"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"media-heading"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">style=</span><span class="s">"color: #31b0d5;"</span><span class="nt">&gt;</span>Trip Index: ${sessionScope.listOfTrips.indexOf(trip)}<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/h4&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"media-heading"</span><span class="nt">&gt;</span>User ID : ${trip.user.getId()}<span class="nt">&lt;/h5&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"col-sm-1 col-md-1 text-center"</span><span class="nt">&gt;&lt;strong&gt;</span>${trip.departure.getName()}<span class="nt">&lt;/strong&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"col-sm-1 col-md-1 text-center"</span><span class="nt">&gt;&lt;strong&gt;</span>${trip.arrival.getName()}<span class="nt">&lt;/strong&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"col-sm-1 col-md-1"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"${sessionScope.listOfTrips.indexOf(trip)}"</span> <span class="na">name=</span><span class="s">"tripIndex"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"delete"</span> <span class="na">name=</span><span class="s">"requestType"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-remove"</span><span class="nt">&gt;&lt;/span&gt;</span> Supprimer
                    <span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/c:forEach&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"post"</span> <span class="na">name=</span><span class="s">"requestType"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-info"</span><span class="nt">&gt;</span>
            Confirmer <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-play"</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">//ShoppingCartServlet.java - Extrait de la méthode doPost();</span>
<span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">String</span> <span class="n">requestType</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"requestType"</span><span class="o">);</span>

<span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="s">"post"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">requestType</span><span class="o">))</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"notice"</span><span class="o">,</span> <span class="s">"Pas de commande à valider !"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Trip</span> <span class="n">trip</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getTripDao</span><span class="o">().</span><span class="na">addTrip</span><span class="o">(</span><span class="n">trip</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">User</span> <span class="n">tmp_user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">idbooster</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">tmp_user</span><span class="o">.</span><span class="na">getIdbooster</span><span class="o">());</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">DaoFactory</span><span class="o">.</span><span class="na">getUserDao</span><span class="o">().</span><span class="na">getUser</span><span class="o">(</span><span class="n">idbooster</span><span class="o">,</span> <span class="n">tmp_user</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
        <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"notice"</span><span class="o">,</span> <span class="s">"Commande bien enregistrée !"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">);</span>

<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="s">"delete"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">requestType</span><span class="o">))</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">tripIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Trip</span><span class="o">&gt;)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">tmp_tripindex</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"tripIndex"</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">tripIndex</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">tmp_tripindex</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">nfe</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO gérer l'exception et l'erreur !</span>
    <span class="o">}</span>
    <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">tripIndex</span><span class="o">);</span>
    <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"listOfTrips"</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
    <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"notice"</span><span class="o">,</span> <span class="s">"Votre voyage a été supprimé de votre liste !"</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">rd</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/auth/shoppingCart.jsp"</span><span class="o">);</span>
<span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
</code></pre>

<p>SupTrip Campus utilise un système de panier. Une fois que notre panier contient au moins un élément, nous ajoutons en base toutes les données en fonction de l&#39;utilisateur qui a commandé.</p>

<aside class="warning">
Il est impossible d'envoyer un panier vide, un message d'erreur sera affiché pour avertir l'utilisateur.
</aside>

<aside class="notice">
L'utilisateur peut selon son envie retourner via un bouton à la liste des voyages ou supprimer un voyage ajouté dans son panier. Un message de confirmation sera affiché pour avertir l'utilisateur que l'action a été affectué.
</aside>

<aside class="success">
Une fois que l'utilisateur confirme sa transaction, toute la liste de voyage sera ajouté en base. Un message de confirmation sera affiché pour avertir l'utilisateur que la prise en compte de ses voyages a été effectué.
</aside>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="html">html</a>
                <a href="#" data-language-name="java">java</a>
          </div>
      </div>
    </div>
  </body>
</html>
